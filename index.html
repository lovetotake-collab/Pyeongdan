<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‰ë‹¨ê°€ & ìˆ˜ìµ ê³„ì‚°ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .calculator-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .buy-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-add {
            background: #4caf50;
            color: white;
            width: 100%;
            padding: 12px;
            font-size: 16px;
            margin-top: 10px;
        }
        
        .btn-add:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76,175,80,0.3);
        }
        
        .btn-delete {
            background: #f44336;
            color: white;
            padding: 8px 12px;
        }
        
        .btn-delete:hover {
            background: #da190b;
        }
        
        .btn-calculate {
            background: #667eea;
            color: white;
            width: 100%;
            padding: 15px;
            font-size: 18px;
        }
        
        .btn-calculate:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.3);
        }
        
        .btn-reset {
            background: #9e9e9e;
            color: white;
            width: 100%;
            padding: 15px;
            font-size: 18px;
        }
        
        .btn-reset:hover {
            background: #757575;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(158,158,158,0.3);
        }
        
        .result-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
        
        .result-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .sell-section {
            margin-top: 15px;
        }
        
        .sell-item {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }
        
        .sell-header {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .sell-result {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #ddd;
        }
        
        .result-item {
            text-align: center;
        }
        
        .result-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .result-number {
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .positive {
            color: #f44336;
        }
        
        .total-result {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 3px solid #ffc107;
        }
        
        .total-result h3 {
            color: #856404;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .total-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .calculator-wrapper {
                grid-template-columns: 1fr;
            }
            
            .buy-row {
                grid-template-columns: 1fr 1fr;
            }
            
            .btn-delete {
                grid-column: span 2;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š í‰ë‹¨ê°€ & ìˆ˜ìµ ê³„ì‚°ê¸°</h1>
        
        <div class="calculator-wrapper">
            <!-- ì™¼ìª½: ë§¤ìˆ˜ ì •ë³´ ì…ë ¥ -->
            <div class="card">
                <h2>ğŸ’° ë§¤ìˆ˜ ì •ë³´</h2>
                
                <div id="buyList">
                    <div class="buy-row">
                        <input type="text" class="buy-price" placeholder="ê°€ê²©" inputmode="numeric">
                        <input type="text" class="buy-quantity" placeholder="ìˆ˜ëŸ‰" inputmode="numeric">
                        <input type="text" class="buy-total" placeholder="í•©ê³„" readonly>
                        <button class="btn-delete" onclick="deleteRow(this)" style="display:none;">ì‚­ì œ</button>
                    </div>
                </div>
                
                <button class="btn-add" onclick="addBuyRow()">+ ë§¤ìˆ˜ ì¶”ê°€</button>
                
                <div class="result-box">
                    <div>í‰ê·  ë‹¨ê°€</div>
                    <div class="result-value" id="avgPrice">0 ì›</div>
                    <div style="font-size: 0.9em;">ì´ ìˆ˜ëŸ‰: <span id="totalQuantity">0</span>ì£¼</div>
                    <div style="font-size: 0.9em;">ì´ íˆ¬ì: <span id="totalInvest">0</span>ì›</div>
                </div>
            </div>
            
            <!-- ì˜¤ë¥¸ìª½: ë§¤ë„ ìˆ˜ìµ ê³„ì‚° -->
            <div class="card">
                <h2>ğŸ’¸ ë§¤ë„ ìˆ˜ìµ ê³„ì‚°</h2>
                
                <div class="sell-section">
                    <div class="sell-item">
                        <div class="sell-header">
                            <label>1ì°¨ ë§¤ë„ê°€ (30%)</label>
                            <input type="text" class="sell-price" id="sell1" placeholder="ë§¤ë„ê°€ ì…ë ¥" inputmode="numeric">
                        </div>
                        <div class="sell-result" id="result1" style="display:none;">
                            <div class="result-item">
                                <div class="result-label">ìˆ˜ìµë¥ </div>
                                <div class="result-number positive" id="rate1">0%</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">ìˆ˜ìµê¸ˆ</div>
                                <div class="result-number positive" id="profit1">0ì›</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sell-item">
                        <div class="sell-header">
                            <label>2ì°¨ ë§¤ë„ê°€ (35%)</label>
                            <input type="text" class="sell-price" id="sell2" placeholder="ë§¤ë„ê°€ ì…ë ¥" inputmode="numeric">
                        </div>
                        <div class="sell-result" id="result2" style="display:none;">
                            <div class="result-item">
                                <div class="result-label">ìˆ˜ìµë¥ </div>
                                <div class="result-number positive" id="rate2">0%</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">ìˆ˜ìµê¸ˆ</div>
                                <div class="result-number positive" id="profit2">0ì›</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sell-item">
                        <div class="sell-header">
                            <label>3ì°¨ ë§¤ë„ê°€ (35%)</label>
                            <input type="text" class="sell-price" id="sell3" placeholder="ë§¤ë„ê°€ ì…ë ¥" inputmode="numeric">
                        </div>
                        <div class="sell-result" id="result3" style="display:none;">
                            <div class="result-item">
                                <div class="result-label">ìˆ˜ìµë¥ </div>
                                <div class="result-number positive" id="rate3">0%</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">ìˆ˜ìµê¸ˆ</div>
                                <div class="result-number positive" id="profit3">0ì›</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                    <button class="btn-calculate" onclick="calculateAll()">ì „ì²´ ê³„ì‚°í•˜ê¸°</button>
                    <button class="btn-reset" onclick="resetAll()">ì´ˆê¸°í™”</button>
                </div>
                
                <div class="total-result" id="totalResult" style="display:none;">
                    <h3>ğŸ¯ ì „ì²´ ìˆ˜ìµ ì •ì‚°</h3>
                    <div class="total-grid">
                        <div class="result-item">
                            <div class="result-label">í‰ê·  ìˆ˜ìµë¥ </div>
                            <div class="result-number positive" id="totalRate">0%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">ì´ ìˆ˜ìµê¸ˆ</div>
                            <div class="result-number positive" id="totalProfit">0ì›</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ìˆ«ìì— ì²œ ë‹¨ìœ„ ì‰¼í‘œ ì¶”ê°€
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
        
        // ì‰¼í‘œ ì œê±°í•˜ê³  ìˆ«ìë¡œ ë³€í™˜
        function parseNumber(str) {
            return parseFloat(str.replace(/,/g, '')) || 0;
        }
        
        // ì…ë ¥ í•„ë“œì— ì‰¼í‘œ ìë™ ì¶”ê°€
        function formatInput(input) {
            const cursorPos = input.selectionStart;
            const oldValue = input.value;
            const oldLength = oldValue.length;
            
            // ì‰¼í‘œ ì œê±° í›„ ìˆ«ìë§Œ ì¶”ì¶œ
            const numValue = oldValue.replace(/,/g, '');
            if (numValue === '') {
                input.value = '';
                return;
            }
            
            // ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ì ì œê±°
            const cleanValue = numValue.replace(/[^\d.]/g, '');
            if (cleanValue === '') {
                input.value = '';
                return;
            }
            
            // ì‰¼í‘œ ì¶”ê°€
            const parts = cleanValue.split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            const formatted = parts.join('.');
            
            input.value = formatted;
            
            // ì»¤ì„œ ìœ„ì¹˜ ì¡°ì • (text inputì—ì„œë§Œ ì‘ë™)
            try {
                const newLength = formatted.length;
                const diff = newLength - oldLength;
                input.setSelectionRange(cursorPos + diff, cursorPos + diff);
            } catch (e) {
                // setSelectionRangeë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš° ë¬´ì‹œ
            }
        }
        
        // ì²« ë²ˆì§¸ ê°€ê²©/ìˆ˜ëŸ‰ ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.querySelector('.buy-price').addEventListener('input', function() {
            formatInput(this);
            calculateBuyRow(this.closest('.buy-row'));
            calculateAverage();
        });
        
        document.querySelector('.buy-quantity').addEventListener('input', function() {
            formatInput(this);
            calculateBuyRow(this.closest('.buy-row'));
            calculateAverage();
        });
        
        function addBuyRow() {
            const buyList = document.getElementById('buyList');
            const newRow = document.createElement('div');
            newRow.className = 'buy-row';
            newRow.innerHTML = `
                <input type="text" class="buy-price" placeholder="ê°€ê²©" inputmode="numeric">
                <input type="text" class="buy-quantity" placeholder="ìˆ˜ëŸ‰" inputmode="numeric">
                <input type="text" class="buy-total" placeholder="í•©ê³„" readonly>
                <button class="btn-delete" onclick="deleteRow(this)">ì‚­ì œ</button>
            `;
            buyList.appendChild(newRow);
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const inputs = newRow.querySelectorAll('.buy-price, .buy-quantity');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    formatInput(this);
                    calculateBuyRow(newRow);
                    calculateAverage();
                });
            });
            
            // ì²« ë²ˆì§¸ í–‰ì˜ ì‚­ì œ ë²„íŠ¼ í‘œì‹œ
            const firstDelete = document.querySelector('.btn-delete');
            if (firstDelete) {
                firstDelete.style.display = 'block';
            }
        }
        
        function deleteRow(button) {
            button.closest('.buy-row').remove();
            calculateAverage();
            
            // í–‰ì´ 1ê°œë§Œ ë‚¨ìœ¼ë©´ ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¹€
            const rows = document.querySelectorAll('.buy-row');
            if (rows.length === 1) {
                rows[0].querySelector('.btn-delete').style.display = 'none';
            }
        }
        
        function calculateBuyRow(row) {
            const price = parseNumber(row.querySelector('.buy-price').value);
            const quantity = parseNumber(row.querySelector('.buy-quantity').value);
            const total = price * quantity;
            row.querySelector('.buy-total').value = total > 0 ? formatNumber(total) : '';
        }
        
        function calculateAverage() {
            const rows = document.querySelectorAll('.buy-row');
            let totalQuantity = 0;
            let totalInvest = 0;
            
            rows.forEach(row => {
                const price = parseNumber(row.querySelector('.buy-price').value);
                const quantity = parseNumber(row.querySelector('.buy-quantity').value);
                totalQuantity += quantity;
                totalInvest += price * quantity;
            });
            
            const avgPrice = totalQuantity > 0 ? totalInvest / totalQuantity : 0;
            
            document.getElementById('avgPrice').textContent = avgPrice.toLocaleString('ko-KR', {maximumFractionDigits: 2}) + ' ì›';
            document.getElementById('totalQuantity').textContent = totalQuantity.toLocaleString('ko-KR');
            document.getElementById('totalInvest').textContent = totalInvest.toLocaleString('ko-KR');
        }
        
        function calculateAll() {
            const rows = document.querySelectorAll('.buy-row');
            let totalQuantity = 0;
            let totalInvest = 0;
            
            rows.forEach(row => {
                const price = parseNumber(row.querySelector('.buy-price').value);
                const quantity = parseNumber(row.querySelector('.buy-quantity').value);
                totalQuantity += quantity;
                totalInvest += price * quantity;
            });
            
            const avgPrice = totalQuantity > 0 ? totalInvest / totalQuantity : 0;
            
            if (avgPrice === 0 || totalQuantity === 0) {
                alert('ë§¤ìˆ˜ ì •ë³´ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            // ë§¤ë„ ë¹„ìœ¨
            const ratios = [0.3, 0.35, 0.35];
            let totalProfitSum = 0;
            let hasAnySell = false;
            
            for (let i = 1; i <= 3; i++) {
                const sellPrice = parseNumber(document.getElementById('sell' + i).value);
                
                if (sellPrice > 0) {
                    hasAnySell = true;
                    const sellQuantity = Math.floor(totalQuantity * ratios[i-1]);
                    const buyAmount = avgPrice * sellQuantity;
                    const sellAmount = sellPrice * sellQuantity;
                    const profit = sellAmount - buyAmount;
                    const rate = ((sellPrice - avgPrice) / avgPrice * 100);
                    
                    document.getElementById('rate' + i).textContent = rate.toFixed(2) + '%';
                    document.getElementById('profit' + i).textContent = Math.round(profit).toLocaleString('ko-KR') + 'ì›';
                    document.getElementById('result' + i).style.display = 'grid';
                    
                    // ìƒ‰ìƒ ì„¤ì •
                    const rateElement = document.getElementById('rate' + i);
                    const profitElement = document.getElementById('profit' + i);
                    if (profit >= 0) {
                        rateElement.style.color = '#f44336';
                        profitElement.style.color = '#f44336';
                    } else {
                        rateElement.style.color = '#2196f3';
                        profitElement.style.color = '#2196f3';
                    }
                    
                    totalProfitSum += profit;
                } else {
                    document.getElementById('result' + i).style.display = 'none';
                }
            }
            
            if (hasAnySell) {
                const totalRate = (totalProfitSum / totalInvest * 100);
                document.getElementById('totalRate').textContent = totalRate.toFixed(2) + '%';
                document.getElementById('totalProfit').textContent = Math.round(totalProfitSum).toLocaleString('ko-KR') + 'ì›';
                document.getElementById('totalResult').style.display = 'block';
                
                // ìƒ‰ìƒ ì„¤ì •
                const totalRateElement = document.getElementById('totalRate');
                const totalProfitElement = document.getElementById('totalProfit');
                if (totalProfitSum >= 0) {
                    totalRateElement.style.color = '#f44336';
                    totalProfitElement.style.color = '#f44336';
                } else {
                    totalRateElement.style.color = '#2196f3';
                    totalProfitElement.style.color = '#2196f3';
                }
            } else {
                alert('ë§¤ë„ê°€ë¥¼ ìµœì†Œ 1ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            }
        }
        
        function resetAll() {
            // ëª¨ë“  ë§¤ìˆ˜ í–‰ì„ ì²« ë²ˆì§¸ ê²ƒë§Œ ë‚¨ê¸°ê³  ì‚­ì œ
            const buyList = document.getElementById('buyList');
            const rows = buyList.querySelectorAll('.buy-row');
            for (let i = rows.length - 1; i > 0; i--) {
                rows[i].remove();
            }
            
            // ì²« ë²ˆì§¸ í–‰ ì´ˆê¸°í™”
            const firstRow = buyList.querySelector('.buy-row');
            firstRow.querySelector('.buy-price').value = '';
            firstRow.querySelector('.buy-quantity').value = '';
            firstRow.querySelector('.buy-total').value = '';
            firstRow.querySelector('.btn-delete').style.display = 'none';
            
            // í‰ê·  ë‹¨ê°€ ì´ˆê¸°í™”
            document.getElementById('avgPrice').textContent = '0 ì›';
            document.getElementById('totalQuantity').textContent = '0';
            document.getElementById('totalInvest').textContent = '0';
            
            // ë§¤ë„ê°€ ì´ˆê¸°í™”
            document.getElementById('sell1').value = '';
            document.getElementById('sell2').value = '';
            document.getElementById('sell3').value = '';
            
            // ìˆ˜ìµ ê²°ê³¼ ìˆ¨ê¸°ê¸°
            document.getElementById('result1').style.display = 'none';
            document.getElementById('result2').style.display = 'none';
            document.getElementById('result3').style.display = 'none';
            
            // ì „ì²´ ìˆ˜ìµ ì •ì‚° ìˆ¨ê¸°ê¸°
            document.getElementById('totalResult').style.display = 'none';
        }
        
        // ì´ˆê¸° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.querySelectorAll('.buy-price, .buy-quantity').forEach(input => {
            input.addEventListener('input', function() {
                formatInput(this);
                calculateBuyRow(this.closest('.buy-row'));
                calculateAverage();
            });
        });
        
        // ë§¤ë„ê°€ ì…ë ¥ ì‹œ ì‰¼í‘œ í¬ë§·íŒ…
        document.querySelectorAll('.sell-price').forEach(input => {
            input.addEventListener('input', function() {
                formatInput(this);
            });
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌèâÎã®Í∞Ä & ÏàòÏùµ Í≥ÑÏÇ∞Í∏∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .calculator-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .buy-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-add {
            background: #4caf50;
            color: white;
            width: 100%;
            padding: 12px;
            font-size: 16px;
            margin-top: 10px;
        }
        
        .btn-add:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76,175,80,0.3);
        }
        
        .btn-delete {
            background: #f44336;
            color: white;
            padding: 8px 12px;
        }
        
        .btn-delete:hover {
            background: #da190b;
        }
        
        .btn-calculate {
            background: #667eea;
            color: white;
            width: 100%;
            padding: 15px;
            font-size: 18px;
        }
        
        .btn-calculate:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.3);
        }
        
        .btn-reset {
            background: #9e9e9e;
            color: white;
            width: 100%;
            padding: 15px;
            font-size: 18px;
        }
        
        .btn-reset:hover {
            background: #757575;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(158,158,158,0.3);
        }
        
        .result-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
        
        .result-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .sell-section {
            margin-top: 15px;
        }
        
        .sell-item {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }
        
        .sell-header {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .sell-result {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #ddd;
        }
        
        .result-item {
            text-align: center;
        }
        
        .result-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .result-number {
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .positive {
            color: #f44336;
        }
        
        .total-result {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 3px solid #ffc107;
        }
        
        .total-result h3 {
            color: #856404;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .total-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .calculator-wrapper {
                grid-template-columns: 1fr;
            }
            
            .buy-row {
                grid-template-columns: 1fr 1fr;
            }
            
            .btn-delete {
                grid-column: span 2;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä ÌèâÎã®Í∞Ä & ÏàòÏùµ Í≥ÑÏÇ∞Í∏∞</h1>
        
        <div class="calculator-wrapper">
            <!-- ÏôºÏ™Ω: Îß§Ïàò Ï†ïÎ≥¥ ÏûÖÎ†• -->
            <div class="card">
                <h2>üí∞ Îß§Ïàò Ï†ïÎ≥¥</h2>
                
                <div id="buyList">
                    <div class="buy-row">
                        <input type="text" class="buy-price" placeholder="Í∞ÄÍ≤©" inputmode="numeric">
                        <input type="text" class="buy-quantity" placeholder="ÏàòÎüâ" inputmode="numeric">
                        <input type="text" class="buy-total" placeholder="Ìï©Í≥Ñ" readonly>
                        <button class="btn-delete" onclick="deleteRow(this)" style="display:none;">ÏÇ≠Ï†ú</button>
                    </div>
                </div>
                
                <button class="btn-add" onclick="addBuyRow()">+ Îß§Ïàò Ï∂îÍ∞Ä</button>
                
                <div class="result-box">
                    <div>ÌèâÍ∑† Îã®Í∞Ä</div>
                    <div class="result-value" id="avgPrice">0 Ïõê</div>
                    <div style="font-size: 0.9em;">Ï¥ù ÏàòÎüâ: <span id="totalQuantity">0</span>Ï£º</div>
                    <div style="font-size: 0.9em;">Ï¥ù Ìà¨Ïûê: <span id="totalInvest">0</span>Ïõê</div>
                </div>
            </div>
            
            <!-- Ïò§Î•∏Ï™Ω: Îß§ÎèÑ ÏàòÏùµ Í≥ÑÏÇ∞ -->
            <div class="card">
                <h2>üí∏ Îß§ÎèÑ ÏàòÏùµ Í≥ÑÏÇ∞</h2>
                
                <div class="sell-section">
                    <div class="sell-item">
                        <div class="sell-header">
                            <label>1Ï∞® Îß§ÎèÑÍ∞Ä (30%)</label>
                            <input type="text" class="sell-price" id="sell1" placeholder="Îß§ÎèÑÍ∞Ä ÏûÖÎ†•" inputmode="numeric">
                        </div>
                        <div class="sell-result" id="result1" style="display:none;">
                            <div class="result-item">
                                <div class="result-label">ÏàòÏùµÎ•†</div>
                                <div class="result-number positive" id="rate1">0%</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">ÏàòÏùµÍ∏à</div>
                                <div class="result-number positive" id="profit1">0Ïõê</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sell-item">
                        <div class="sell-header">
                            <label>2Ï∞® Îß§ÎèÑÍ∞Ä (35%)</label>
                            <input type="text" class="sell-price" id="sell2" placeholder="Îß§ÎèÑÍ∞Ä ÏûÖÎ†•" inputmode="numeric">
                        </div>
                        <div class="sell-result" id="result2" style="display:none;">
                            <div class="result-item">
                                <div class="result-label">ÏàòÏùµÎ•†</div>
                                <div class="result-number positive" id="rate2">0%</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">ÏàòÏùµÍ∏à</div>
                                <div class="result-number positive" id="profit2">0Ïõê</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sell-item">
                        <div class="sell-header">
                            <label>3Ï∞® Îß§ÎèÑÍ∞Ä (35%)</label>
                            <input type="text" class="sell-price" id="sell3" placeholder="Îß§ÎèÑÍ∞Ä ÏûÖÎ†•" inputmode="numeric">
                        </div>
                        <div class="sell-result" id="result3" style="display:none;">
                            <div class="result-item">
                                <div class="result-label">ÏàòÏùµÎ•†</div>
                                <div class="result-number positive" id="rate3">0%</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">ÏàòÏùµÍ∏à</div>
                                <div class="result-number positive" id="profit3">0Ïõê</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                    <button class="btn-calculate" onclick="calculateAll()">Ï†ÑÏ≤¥ Í≥ÑÏÇ∞ÌïòÍ∏∞</button>
                    <button class="btn-reset" onclick="resetAll()">Ï¥àÍ∏∞Ìôî</button>
                </div>
                
                <div class="total-result" id="totalResult" style="display:none;">
                    <h3>üéØ Ï†ÑÏ≤¥ ÏàòÏùµ Ï†ïÏÇ∞</h3>
                    <div class="total-grid">
                        <div class="result-item">
                            <div class="result-label">ÌèâÍ∑† ÏàòÏùµÎ•†</div>
                            <div class="result-number positive" id="totalRate">0%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Ï¥ù ÏàòÏùµÍ∏à</div>
                            <div class="result-number positive" id="totalProfit">0Ïõê</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Ïà´ÏûêÏóê Ï≤ú Îã®ÏúÑ ÏâºÌëú Ï∂îÍ∞Ä
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
        
        // ÏâºÌëú Ï†úÍ±∞ÌïòÍ≥† Ïà´ÏûêÎ°ú Î≥ÄÌôò
        function parseNumber(str) {
            return parseFloat(str.replace(/,/g, '')) || 0;
        }
        
        // ÏûÖÎ†• ÌïÑÎìúÏóê ÏâºÌëú ÏûêÎèô Ï∂îÍ∞Ä
        function formatInput(input) {
            const cursorPos = input.selectionStart;
            const oldValue = input.value;
            const oldLength = oldValue.length;
            
            // ÏâºÌëú Ï†úÍ±∞ ÌõÑ Ïà´ÏûêÎßå Ï∂îÏ∂ú
            const numValue = oldValue.replace(/,/g, '');
            if (numValue === '') {
                input.value = '';
                return;
            }
            
            // Ïà´ÏûêÍ∞Ä ÏïÑÎãå Î¨∏Ïûê Ï†úÍ±∞
            const cleanValue = numValue.replace(/[^\d.]/g, '');
            if (cleanValue === '') {
                input.value = '';
                return;
            }
            
            // ÏâºÌëú Ï∂îÍ∞Ä
            const parts = cleanValue.split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            const formatted = parts.join('.');
            
            input.value = formatted;
            
            // Ïª§ÏÑú ÏúÑÏπò Ï°∞Ï†ï (text inputÏóêÏÑúÎßå ÏûëÎèô)
            try {
                const newLength = formatted.length;
                const diff = newLength - oldLength;
                input.setSelectionRange(cursorPos + diff, cursorPos + diff);
            } catch (e) {
                // setSelectionRangeÎ•º ÏßÄÏõêÌïòÏßÄ ÏïäÎäî Í≤ΩÏö∞ Î¨¥Ïãú
            }
        }
        
        // Ï≤´ Î≤àÏß∏ Í∞ÄÍ≤©/ÏàòÎüâ ÏûÖÎ†• Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.querySelector('.buy-price').addEventListener('input', function() {
            formatInput(this);
            calculateBuyRow(this.closest('.buy-row'));
            calculateAverage();
        });
        
        document.querySelector('.buy-quantity').addEventListener('input', function() {
            formatInput(this);
            calculateBuyRow(this.closest('.buy-row'));
            calculateAverage();
        });
        
        function addBuyRow() {
            const buyList = document.getElementById('buyList');
            const newRow = document.createElement('div');
            newRow.className = 'buy-row';
            newRow.innerHTML = `
                <input type="text" class="buy-price" placeholder="Í∞ÄÍ≤©" inputmode="numeric">
                <input type="text" class="buy-quantity" placeholder="ÏàòÎüâ" inputmode="numeric">
                <input type="text" class="buy-total" placeholder="Ìï©Í≥Ñ" readonly>
                <button class="btn-delete" onclick="deleteRow(this)">ÏÇ≠Ï†ú</button>
            `;
            buyList.appendChild(newRow);
            
            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
            const inputs = newRow.querySelectorAll('.buy-price, .buy-quantity');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    formatInput(this);
                    calculateBuyRow(newRow);
                    calculateAverage();
                });
            });
            
            // Ï≤´ Î≤àÏß∏ ÌñâÏùò ÏÇ≠Ï†ú Î≤ÑÌäº ÌëúÏãú
            const firstDelete = document.querySelector('.btn-delete');
            if (firstDelete) {
                firstDelete.style.display = 'block';
            }
        }
        
        function deleteRow(button) {
            button.closest('.buy-row').remove();
            calculateAverage();
            
            // ÌñâÏù¥ 1Í∞úÎßå ÎÇ®ÏúºÎ©¥ ÏÇ≠Ï†ú Î≤ÑÌäº Ïà®ÍπÄ
            const rows = document.querySelectorAll('.buy-row');
            if (rows.length === 1) {
                rows[0].querySelector('.btn-delete').style.display = 'none';
            }
        }
        
        function calculateBuyRow(row) {
            const price = parseNumber(row.querySelector('.buy-price').value);
            const quantity = parseNumber(row.querySelector('.buy-quantity').value);
            const total = price * quantity;
            row.querySelector('.buy-total').value = total > 0 ? formatNumber(total) : '';
        }
        
        function calculateAverage() {
            const rows = document.querySelectorAll('.buy-row');
            let totalQuantity = 0;
            let totalInvest = 0;
            
            rows.forEach(row => {
                const price = parseNumber(row.querySelector('.buy-price').value);
                const quantity = parseNumber(row.querySelector('.buy-quantity').value);
                totalQuantity += quantity;
                totalInvest += price * quantity;
            });
            
            const avgPrice = totalQuantity > 0 ? totalInvest / totalQuantity : 0;
            
            document.getElementById('avgPrice').textContent = avgPrice.toLocaleString('ko-KR', {maximumFractionDigits: 2}) + ' Ïõê';
            document.getElementById('totalQuantity').textContent = totalQuantity.toLocaleString('ko-KR');
            document.getElementById('totalInvest').textContent = totalInvest.toLocaleString('ko-KR');
        }
        
        function calculateAll() {
            const rows = document.querySelectorAll('.buy-row');
            let totalQuantity = 0;
            let totalInvest = 0;
            
            rows.forEach(row => {
                const price = parseNumber(row.querySelector('.buy-price').value);
                const quantity = parseNumber(row.querySelector('.buy-quantity').value);
                totalQuantity += quantity;
                totalInvest += price * quantity;
            });
            
            const avgPrice = totalQuantity > 0 ? totalInvest / totalQuantity : 0;
            
            if (avgPrice === 0 || totalQuantity === 0) {
                alert('Îß§Ïàò Ï†ïÎ≥¥Î•º Î®ºÏ†Ä ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            // Îß§ÎèÑ ÎπÑÏú®
            const ratios = [0.3, 0.35, 0.35];
            let totalProfitSum = 0;
            let hasAnySell = false;
            
            for (let i = 1; i <= 3; i++) {
                const sellPrice = parseNumber(document.getElementById('sell' + i).value);
                
                if (sellPrice > 0) {
                    hasAnySell = true;
                    const sellQuantity = Math.floor(totalQuantity * ratios[i-1]);
                    const buyAmount = avgPrice * sellQuantity;
                    const sellAmount = sellPrice * sellQuantity;
                    const profit = sellAmount - buyAmount;
                    const rate = ((sellPrice - avgPrice) / avgPrice * 100);
                    
                    document.getElementById('rate' + i).textContent = rate.toFixed(2) + '%';
                    document.getElementById('profit' + i).textContent = Math.round(profit).toLocaleString('ko-KR') + 'Ïõê';
                    document.getElementById('result' + i).style.display = 'grid';
                    
                    // ÏÉâÏÉÅ ÏÑ§Ï†ï
                    const rateElement = document.getElementById('rate' + i);
                    const profitElement = document.getElementById('profit' + i);
                    if (profit >= 0) {
                        rateElement.style.color = '#f44336';
                        profitElement.style.color = '#f44336';
                    } else {
                        rateElement.style.color = '#2196f3';
                        profitElement.style.color = '#2196f3';
                    }
                    
                    totalProfitSum += profit;
                } else {
                    document.getElementById('result' + i).style.display = 'none';
                }
            }
            
            if (hasAnySell) {
                const totalRate = (totalProfitSum / totalInvest * 100);
                document.getElementById('totalRate').textContent = totalRate.toFixed(2) + '%';
                document.getElementById('totalProfit').textContent = Math.round(totalProfitSum).toLocaleString('ko-KR') + 'Ïõê';
                document.getElementById('totalResult').style.display = 'block';
                
                // ÏÉâÏÉÅ ÏÑ§Ï†ï
                const totalRateElement = document.getElementById('totalRate');
                const totalProfitElement = document.getElementById('totalProfit');
                if (totalProfitSum >= 0) {
                    totalRateElement.style.color = '#f44336';
                    totalProfitElement.style.color = '#f44336';
                } else {
                    totalRateElement.style.color = '#2196f3';
                    totalProfitElement.style.color = '#2196f3';
                }
            } else {
                alert('Îß§ÎèÑÍ∞ÄÎ•º ÏµúÏÜå 1Í∞ú Ïù¥ÏÉÅ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
            }
        }
        
        function resetAll() {
            // Î™®Îì† Îß§Ïàò ÌñâÏùÑ Ï≤´ Î≤àÏß∏ Í≤ÉÎßå ÎÇ®Í∏∞Í≥† ÏÇ≠Ï†ú
            const buyList = document.getElementById('buyList');
            const rows = buyList.querySelectorAll('.buy-row');
            for (let i = rows.length - 1; i > 0; i--) {
                rows[i].remove();
            }
            
            // Ï≤´ Î≤àÏß∏ Ìñâ Ï¥àÍ∏∞Ìôî
            const firstRow = buyList.querySelector('.buy-row');
            firstRow.querySelector('.buy-price').value = '';
            firstRow.querySelector('.buy-quantity').value = '';
            firstRow.querySelector('.buy-total').value = '';
            firstRow.querySelector('.btn-delete').style.display = 'none';
            
            // ÌèâÍ∑† Îã®Í∞Ä Ï¥àÍ∏∞Ìôî
            document.getElementById('avgPrice').textContent = '0 Ïõê';
            document.getElementById('totalQuantity').textContent = '0';
            document.getElementById('totalInvest').textContent = '0';
            
            // Îß§ÎèÑÍ∞Ä Ï¥àÍ∏∞Ìôî
            document.getElementById('sell1').value = '';
            document.getElementById('sell2').value = '';
            document.getElementById('sell3').value = '';
            
            // ÏàòÏùµ Í≤∞Í≥º Ïà®Í∏∞Í∏∞
            document.getElementById('result1').style.display = 'none';
            document.getElementById('result2').style.display = 'none';
            document.getElementById('result3').style.display = 'none';
            
            // Ï†ÑÏ≤¥ ÏàòÏùµ Ï†ïÏÇ∞ Ïà®Í∏∞Í∏∞
            document.getElementById('totalResult').style.display = 'none';
        }
        
        // Ï¥àÍ∏∞ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        document.querySelectorAll('.buy-price, .buy-quantity').forEach(input => {
            input.addEventListener('input', function() {
                formatInput(this);
                calculateBuyRow(this.closest('.buy-row'));
                calculateAverage();
            });
        });
        
        // Îß§ÎèÑÍ∞Ä ÏûÖÎ†• Ïãú ÏâºÌëú Ìè¨Îß∑ÌåÖ
        document.querySelectorAll('.sell-price').forEach(input => {
            input.addEventListener('input', function() {
                formatInput(this);
            });
        });
    </script>
</body>
</html>
